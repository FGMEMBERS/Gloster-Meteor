<?xml version="1.0" encoding="ISO-8859-1"?>

<system name="fuel">

  <property value="1">systems/fuel/cross-flow-valve-norm</property>

  <channel name="fwd tank">
   <pure_gain name="systems/fuel/fwd-tank-level-norm">
    <input>propulsion/tank[0]/contents-lbs</input>
    <gain>0.00079674926</gain><!-- 1/1255.1, the tank capacity -->
    <clipto>
     <min> 0 </min>
     <max> 1 </max>
    </clipto> 
   </pure_gain>

   <pure_gain name="systems/fuel/fwd-tank-level-in">
    <input>systems/fuel/fwd-tank-level-norm</input>
    <gain>50</gain><!-- 50 inches, the tank depth (guess based on external view -->
    <clipto>
     <min> 0 </min>
     <max> 50 </max>
    </clipto> 
   </pure_gain>

   <fcs_function name="systems/fuel/fwd-tank-head"> <!-- negative on purpose -->
    <function>
     <max>
      <difference>
       <property>propulsion/tank[0]/contents-lbs</property>
       <value>1255.1</value>
      </difference>
      <product>
       <property>propulsion/tank[1]/contents-lbs</property>
       <value>-1</value>
      </product>
     </max>
    </function>

   </fcs_function>

  </channel>

  <channel name="aft tank">
   <pure_gain name="systems/fuel/aft-tank-level-norm">
    <input>propulsion/tank[1]/contents-lbs</input>
    <gain>0.00079674926</gain><!-- 1/1255.1, the tank capacity -->
    <clipto>
     <min> 0 </min>
     <max> 1 </max>
    </clipto> 
   </pure_gain>

   <pure_gain name="systems/fuel/aft-tank-level-in">
    <input>systems/fuel/aft-tank-level-norm</input>
    <gain>50</gain><!-- 50 inches, the tank depth (guess based on external view -->
    <clipto>
     <min> 0 </min>
     <max> 50 </max>
    </clipto> 
   </pure_gain>

   <fcs_function name="systems/fuel/aft-tank-head">
    <function>
     <min>
      <difference>
       <value>1255.1</value>
       <property>propulsion/tank[1]/contents-lbs</property>
      </difference>
      <property>propulsion/tank[0]/contents-lbs</property>
     </min>
    </function>
   </fcs_function>

  </channel>

  <channel name="Delta Z">
  
   <fcs_function name="systems/fuel/tank-pitchz-in">
    <function>
     <product>
      <sin>
       <property>attitude/theta-rad</property>
      </sin>
      <value> 19.5 </value> <!-- 330 gallon cylindrical tank, 50 inches in diameter is 39 inches long -->
     </product>
    </function>
   </fcs_function>

   <fcs_function name="systems/fuel/tank-z-in">
    <function>
     <sum>
      <property>systems/fuel/tank-pitchz-in</property>
      <difference>
       <property>systems/fuel/fwd-tank-level-in</property>
       <property>systems/fuel/aft-tank-level-in</property>
      </difference>
     </sum>
    </function>
   </fcs_function>
   
   <fcs_function name="systems/fuel/transfer-rate-lb_s">
    <function>
     <product>
      <property>systems/fuel/tank-z-in</property>
      <value>0.0286</value><!-- fuel mass, lb/in3 -->
      <value>25.0</value><!-- K -->
      <property>systems/fuel/cross-flow-valve-norm</property>
     </product>
    </function>
    <clipto>
     <min>systems/fuel/fwd-tank-head</min>
     <max>systems/fuel/aft-tank-head</max>
    </clipto>
    <output>propulsion/tank[1]/external-flow-rate-pps</output>
   </fcs_function>

   <pure_gain name="transfer-rate-lb_s-inverse">
    <input>systems/fuel/transfer-rate-lb_s</input>
    <gain>-1</gain>
    <output>propulsion/tank[0]/external-flow-rate-pps</output>
   </pure_gain>

  </channel>
</system>
